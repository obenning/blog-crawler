<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kerberos Compliance Blog - KI-freundliche Suche</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 1rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .search-box {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .search-input {
            width: 100%;
            padding: 1rem;
            font-size: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .filters {
            margin-top: 1rem;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .filter-btn:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .stats {
            text-align: center;
            margin: 1rem 0;
            color: #666;
            font-size: 0.95rem;
        }

        .articles {
            display: grid;
            gap: 1.5rem;
        }

        .article-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .article-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .article-title {
            font-size: 1.3rem;
            color: #667eea;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .article-meta {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #666;
        }

        .article-meta span {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .article-excerpt {
            color: #555;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .highlight {
            background: #fff59d;
            padding: 0 2px;
            border-radius: 2px;
        }

        .article-links {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .article-link {
            padding: 0.5rem 1rem;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: background 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .article-link:hover {
            background: #5568d3;
        }

        .article-link.secondary {
            background: #e0e0e0;
            color: #333;
        }

        .article-link.secondary:hover {
            background: #d0d0d0;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .ai-info {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .ai-info h3 {
            color: #1976d2;
            margin-bottom: 0.5rem;
        }

        .ai-info code {
            background: white;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-family: monospace;
            color: #d32f2f;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .article-card {
                padding: 1rem;
            }

            .article-title {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ü§ñ Kerberos Compliance Blog - KI-freundliche Suche</h1>
        <p>Durchsuchbares Archiv aller Blog-Artikel</p>
    </div>

    <div class="container">
        <div class="ai-info">
            <h3>üìö F√ºr KI-Nutzung optimiert</h3>
            <p>Diese Seite nutzt <code>raw.githubusercontent.com</code> URLs, die von KIs wie Claude geladen werden k√∂nnen.</p>
            <div style="margin-top: 1rem; display: flex; gap: 1rem; flex-wrap: wrap;">
                <button onclick="window.open('https://raw.githubusercontent.com/obenning/blog-crawler/main/blog_content/ALL_ARTICLES_COMBINED.md', '_blank')" 
                        style="padding: 0.75rem 1.5rem; background: #2196f3; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                    üìö Alle Artikel als ein Dokument
                </button>
                <span style="color: #666; align-self: center; font-size: 0.9rem;">
                    Perfekt um den gesamten Blog-Fundus an deine KI zu geben!
                </span>
            </div>
        </div>

        <div class="search-box">
            <input 
                type="text" 
                id="searchInput" 
                class="search-input" 
                placeholder="üîç Suche nach Themen, Autoren, Schlagworten..." 
                autocomplete="off"
            />
            <div class="filters" id="authorFilters"></div>
        </div>

        <div class="stats" id="stats">Lade Artikel...</div>

        <div id="loading" class="loading">
            <p>‚è≥ Lade Blog-Artikel...</p>
        </div>

        <div id="error" style="display: none;"></div>
        <div id="articles" class="articles"></div>
    </div>

    <script>
        // ===== KONFIGURATION =====
        const GITHUB_USER = 'obenning';
        const GITHUB_REPO = 'blog-crawler';
        const GITHUB_BRANCH = 'main';
        const INDEX_FILE = 'articles_index.json';

        // Lade Index via raw.githubusercontent.com (KI-freundlich!)
        const INDEX_URL = `https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/${GITHUB_BRANCH}/blog_content/${INDEX_FILE}`;

        // ===== GLOBALE VARIABLEN =====
        let allArticles = [];
        let filteredArticles = [];
        let currentAuthorFilter = null;

        // ===== INITIALISIERUNG =====
        async function init() {
            try {
                const response = await fetch(INDEX_URL);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: Konnte Index nicht laden`);
                }

                const data = await response.json();
                allArticles = data.articles || [];

                document.getElementById('loading').style.display = 'none';
                
                if (allArticles.length === 0) {
                    showError('Keine Artikel gefunden.');
                    return;
                }

                setupAuthorFilters();
                displayArticles(allArticles);
                setupSearch();

            } catch (error) {
                console.error('Fehler beim Laden:', error);
                document.getElementById('loading').style.display = 'none';
                showError(`Fehler beim Laden der Artikel: ${error.message}`);
            }
        }

        // ===== AUTOREN-FILTER =====
        function setupAuthorFilters() {
            const authorCounts = {};
            allArticles.forEach(article => {
                const author = article.author || 'Unknown';
                authorCounts[author] = (authorCounts[author] || 0) + 1;
            });

            const sortedAuthors = Object.entries(authorCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            const filtersDiv = document.getElementById('authorFilters');
            filtersDiv.innerHTML = '<span style="margin-right: 1rem; color: #666;">Filter nach Autor:</span>';

            const allBtn = document.createElement('button');
            allBtn.className = 'filter-btn active';
            allBtn.textContent = `Alle (${allArticles.length})`;
            allBtn.onclick = () => filterByAuthor(null);
            filtersDiv.appendChild(allBtn);

            sortedAuthors.forEach(([author, count]) => {
                const btn = document.createElement('button');
                btn.className = 'filter-btn';
                btn.textContent = `${author} (${count})`;
                btn.onclick = () => filterByAuthor(author);
                filtersDiv.appendChild(btn);
            });
        }

        function filterByAuthor(author) {
            currentAuthorFilter = author;

            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            performSearch(searchTerm);
        }

        // ===== SUCHE =====
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', (e) => {
                performSearch(e.target.value.toLowerCase());
            });
        }

        function performSearch(searchTerm) {
            let results = allArticles;

            // Autoren-Filter
            if (currentAuthorFilter) {
                results = results.filter(article => 
                    article.author === currentAuthorFilter
                );
            }

            // Text-Suche (inkl. Volltext!)
            if (searchTerm) {
                const terms = searchTerm.split(/\s+/).filter(t => t.length > 0);
                results = results.filter(article => {
                    const searchableText = [
                        article.title,
                        article.author,
                        article.excerpt,
                        article.full_text || ''  // Volltext-Suche!
                    ].join(' ').toLowerCase();

                    return terms.every(term => searchableText.includes(term));
                });
            }

            filteredArticles = results;
            displayArticles(results, searchTerm);
        }

        // ===== ANZEIGE =====
        function displayArticles(articles, searchTerm = '') {
            const articlesDiv = document.getElementById('articles');
            const statsDiv = document.getElementById('stats');

            statsDiv.textContent = `${articles.length} von ${allArticles.length} Artikel${articles.length !== 1 ? 'n' : ''}`;

            if (articles.length === 0) {
                articlesDiv.innerHTML = '<p style="text-align: center; padding: 2rem; color: #666;">Keine Artikel gefunden.</p>';
                return;
            }

            articlesDiv.innerHTML = articles.map(article => {
                const highlightedTitle = highlightText(article.title, searchTerm);
                
                // Finde relevanten Kontext im Volltext wenn Suchbegriff vorhanden
                let displayExcerpt = article.excerpt;
                if (searchTerm && article.full_text) {
                    const context = extractContext(article.full_text, searchTerm, 200);
                    if (context) {
                        displayExcerpt = context;
                    }
                }
                
                const highlightedExcerpt = highlightText(displayExcerpt, searchTerm);

                return `
                    <div class="article-card">
                        <h2 class="article-title">${highlightedTitle}</h2>
                        <div class="article-meta">
                            <span>üë§ ${escapeHtml(article.author)}</span>
                            <span>üìÖ ${formatDate(article.date)}</span>
                            <span>üìù ${article.word_count.toLocaleString('de-DE')} W√∂rter</span>
                        </div>
                        <p class="article-excerpt">${highlightedExcerpt}</p>
                        <div class="article-links">
                            <a href="${article.url}" target="_blank" class="article-link">
                                üåê Original-Artikel
                            </a>
                            <a href="${article.raw_url}" target="_blank" class="article-link secondary" title="Direkt-Link f√ºr KI-Nutzung">
                                ü§ñ Raw-Link f√ºr KI
                            </a>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ===== HILFSFUNKTIONEN =====
        function extractContext(text, searchTerm, contextLength = 200) {
            if (!text || !searchTerm) return null;
            
            const terms = searchTerm.toLowerCase().split(/\s+/).filter(t => t.length > 0);
            const lowerText = text.toLowerCase();
            
            // Finde erste Position eines Suchbegriffs
            let bestPos = -1;
            for (const term of terms) {
                const pos = lowerText.indexOf(term);
                if (pos !== -1 && (bestPos === -1 || pos < bestPos)) {
                    bestPos = pos;
                }
            }
            
            if (bestPos === -1) return null;
            
            // Extrahiere Kontext um die Fundstelle
            const start = Math.max(0, bestPos - contextLength / 2);
            const end = Math.min(text.length, bestPos + contextLength / 2);
            
            let context = text.substring(start, end);
            
            // F√ºge ... hinzu wenn abgeschnitten
            if (start > 0) context = '...' + context;
            if (end < text.length) context = context + '...';
            
            return context;
        }
        function highlightText(text, searchTerm) {
            if (!searchTerm) return escapeHtml(text);

            const terms = searchTerm.split(/\s+/).filter(t => t.length > 0);
            let result = escapeHtml(text);

            terms.forEach(term => {
                const regex = new RegExp(`(${escapeRegex(term)})`, 'gi');
                result = result.replace(regex, '<span class="highlight">$1</span>');
            });

            return result;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function escapeRegex(str) {
            return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function formatDate(dateStr) {
            if (!dateStr) return 'Unbekannt';
            try {
                const date = new Date(dateStr);
                return date.toLocaleDateString('de-DE', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            } catch {
                return dateStr;
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        // ===== START =====
        init();
    </script>
</body>
</html>
